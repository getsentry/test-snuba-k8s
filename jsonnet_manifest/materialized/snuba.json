{
   "snuba-admin": {
      "apiVersion": "apps/v1",
      "kind": "Deployment",
      "metadata": {
         "labels": {
            "app_feature": "something",
            "app_function": "storage",
            "component": "admin",
            "service": "snuba",
            "subsystem": null,
            "system": "kafka_consumer"
         },
         "name": "snuba-admin",
         "namespace": "default"
      },
      "spec": {
         "minReadySeconds": 60,
         "replicas": 1,
         "selector": {
            "matchLabels": {
               "component": "admin",
               "service": "snuba"
            }
         },
         "strategy": {
            "rollingUpdate": {
               "maxSurge": 100,
               "maxUnavailable": 0
            }
         },
         "template": {
            "metadata": {
               "annotations": {
                  "configVersion": "1b6513a9eaebcd3a0cd7523829ea7cdb"
               },
               "labels": {
                  "app_feature": "something",
                  "app_function": "storage",
                  "component": "admin",
                  "service": "snuba",
                  "subsystem": null,
                  "system": "kafka_consumer"
               }
            },
            "spec": {
               "containers": [
                  {
                     "args": [
                        "admin",
                        "--processes=3",
                        "--threads=4"
                     ],
                     "env": [
                        {
                           "name": "CLICKHOUSE_MIGRATIONS_USER",
                           "value": "snuba"
                        },
                        {
                           "name": "ENVOY_ADMIN_PORT",
                           "value": "15000"
                        },
                        {
                           "name": "SENTRY_ENVIRONMENT",
                           "value": "st-mystuff"
                        },
                        {
                           "name": "SNUBA_PROFILES_SAMPLE_RATE",
                           "value": "1.0"
                        },
                        {
                           "name": "SNUBA_SETTINGS",
                           "value": "/etc/snuba.conf.py"
                        },
                        {
                           "name": "UWSGI_DIE_ON_TERM",
                           "value": "true"
                        },
                        {
                           "name": "UWSGI_DISABLE_LOGGING",
                           "value": "true"
                        },
                        {
                           "name": "UWSGI_DISABLE_WRITE_EXCEPTION",
                           "value": "true"
                        },
                        {
                           "name": "UWSGI_ENABLE_THREADS",
                           "value": "true"
                        },
                        {
                           "name": "UWSGI_HTTP_SOCKET",
                           "value": "0.0.0.0:8000"
                        },
                        {
                           "name": "UWSGI_IGNORE_SIGPIPE",
                           "value": "true"
                        },
                        {
                           "name": "UWSGI_IGNORE_WRITE_ERRORS",
                           "value": "true"
                        },
                        {
                           "name": "UWSGI_MAX_REQUESTS",
                           "value": "10000"
                        },
                        {
                           "name": "UWSGI_NEED_APP",
                           "value": "true"
                        }
                     ],
                     "image": "us.gcr.io/sentryio/snuba:92816dfc25a17de2dccd3df68a86d8de2871bfc8",
                     "lifecycle": {
                        "preStop": {
                           "exec": {
                              "command": [
                                 "/bin/sh",
                                 "-ec",
                                 "touch /tmp/snuba.down && sleep 40"
                              ]
                           }
                        }
                     },
                     "livenessProbe": {
                        "httpGet": {
                           "path": "/health",
                           "port": 8000
                        },
                        "initialDelaySeconds": 10,
                        "periodSeconds": 10
                     },
                     "name": "snuba-admin",
                     "ports": [
                        8000
                     ],
                     "readinessProbe": {
                        "httpGet": {
                           "path": "/health",
                           "port": 8000
                        },
                        "initialDelaySeconds": 10,
                        "periodSeconds": 5
                     },
                     "resources": {
                        "requests": {
                           "cpu": "5000m",
                           "memory": "5Gi"
                        }
                     },
                     "startupProbe": {
                        "httpGet": {
                           "path": "/health",
                           "port": 8000
                        },
                        "initialDelaySeconds": 10,
                        "periodSeconds": 10
                     }
                  }
               ],
               "serviceAccountName": "snuba-admin"
            }
         }
      }
   },
   "snuba-api": {
      "apiVersion": "apps/v1",
      "kind": "Deployment",
      "metadata": {
         "labels": {
            "app_feature": "something",
            "app_function": "storage",
            "component": "api",
            "service": "snuba",
            "subsystem": null,
            "system": "kafka_consumer"
         },
         "name": "snuba-api",
         "namespace": "default"
      },
      "spec": {
         "minReadySeconds": 60,
         "replicas": 1,
         "selector": {
            "matchLabels": {
               "component": "api",
               "service": "snuba"
            }
         },
         "strategy": {
            "rollingUpdate": {
               "maxSurge": 100,
               "maxUnavailable": 0
            }
         },
         "template": {
            "metadata": {
               "annotations": {
                  "configVersion": "1b6513a9eaebcd3a0cd7523829ea7cdb"
               },
               "labels": {
                  "app_feature": "something",
                  "app_function": "storage",
                  "component": "api",
                  "service": "snuba",
                  "subsystem": null,
                  "system": "kafka_consumer"
               }
            },
            "spec": {
               "containers": [
                  {
                     "args": [
                        "api",
                        "--processes=3",
                        "--threads=4"
                     ],
                     "env": [
                        {
                           "name": "CLICKHOUSE_MIGRATIONS_USER",
                           "value": "snuba"
                        },
                        {
                           "name": "ENVOY_ADMIN_PORT",
                           "value": "15000"
                        },
                        {
                           "name": "SENTRY_ENVIRONMENT",
                           "value": "st-mystuff"
                        },
                        {
                           "name": "SNUBA_PROFILES_SAMPLE_RATE",
                           "value": "1.0"
                        },
                        {
                           "name": "SNUBA_SETTINGS",
                           "value": "/etc/snuba.conf.py"
                        },
                        {
                           "name": "UWSGI_DIE_ON_TERM",
                           "value": "true"
                        },
                        {
                           "name": "UWSGI_DISABLE_LOGGING",
                           "value": "true"
                        },
                        {
                           "name": "UWSGI_DISABLE_WRITE_EXCEPTION",
                           "value": "true"
                        },
                        {
                           "name": "UWSGI_ENABLE_THREADS",
                           "value": "true"
                        },
                        {
                           "name": "UWSGI_HTTP_SOCKET",
                           "value": "0.0.0.0:1218"
                        },
                        {
                           "name": "UWSGI_IGNORE_SIGPIPE",
                           "value": "true"
                        },
                        {
                           "name": "UWSGI_IGNORE_WRITE_ERRORS",
                           "value": "true"
                        },
                        {
                           "name": "UWSGI_MAX_REQUESTS",
                           "value": "10000"
                        },
                        {
                           "name": "UWSGI_NEED_APP",
                           "value": "true"
                        }
                     ],
                     "image": "us.gcr.io/sentryio/snuba:92816dfc25a17de2dccd3df68a86d8de2871bfc8",
                     "lifecycle": {
                        "preStop": {
                           "exec": {
                              "command": [
                                 "/bin/sh",
                                 "-ec",
                                 "touch /tmp/snuba.down && sleep 40"
                              ]
                           }
                        }
                     },
                     "livenessProbe": {
                        "httpGet": {
                           "path": "/health",
                           "port": 1218
                        },
                        "initialDelaySeconds": 10,
                        "periodSeconds": 10
                     },
                     "name": "snuba-api",
                     "ports": [
                        1218
                     ],
                     "readinessProbe": {
                        "httpGet": {
                           "path": "/health",
                           "port": 1218
                        },
                        "initialDelaySeconds": 10,
                        "periodSeconds": 5
                     },
                     "resources": {
                        "requests": {
                           "cpu": "5000m",
                           "memory": "5Gi"
                        }
                     },
                     "startupProbe": {
                        "httpGet": {
                           "path": "/health",
                           "port": 1218
                        },
                        "initialDelaySeconds": 10,
                        "periodSeconds": 10
                     }
                  }
               ],
               "serviceAccountName": "snuba-api"
            }
         }
      }
   }
}
